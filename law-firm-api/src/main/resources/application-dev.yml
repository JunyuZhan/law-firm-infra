# 数据源配置
spring:
  datasource:
    driver-class-name: org.h2.Driver
    url: jdbc:h2:mem:testdb;MODE=MySQL;DB_CLOSE_DELAY=-1;DATABASE_TO_LOWER=TRUE
    username: sa
    password: 
    type: com.zaxxer.hikari.HikariDataSource
  
  # Redis配置
  data:
    redis:
      host: localhost
      port: 6379
      database: 0
      timeout: 10000
      lettuce:
        pool:
          max-active: 8
          max-wait: -1
          max-idle: 8
          min-idle: 0
  
  # 允许Bean覆盖和循环引用
  main:
    allow-bean-definition-overriding: true
    allow-circular-references: true

# 数据库初始化配置
sql:
  init:
    mode: always
    schema-locations: classpath:db/schema.sql
    data-locations: classpath:db/data.sql
    continue-on-error: false

# 开发模式配置
dev:
  use-redis: true
  auth:
    # Redis存储会话
    session-store: redis
    # 启用Redis会话
    disable-redis: false
    # 简化安全配置
    simplified-security: true
    # 禁用原始安全配置
    disable-original-security: true
    # 令牌有效期（秒）
    token-expiration: 86400

# 日志配置
logging:
  level:
    root: INFO
    com.lawfirm: DEBUG
    org.mybatis: INFO
    com.baomidou.mybatisplus: INFO
    org.springframework.jdbc: DEBUG
    org.springframework: INFO
    org.springframework.boot.autoconfigure: DEBUG
    org.springframework.context: DEBUG
    org.springframework.beans: DEBUG

# AI模块配置
law.firm.ai:
  enabled: true
  defaultProvider: openai
  timeout: 30
  maxConcurrentRequests: 10
  enableCache: true
  debug: true

# MyBatis-Plus配置
mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
  # 实体类扫描路径，使用通配符
  type-aliases-package: com.lawfirm.model.**.entity
  # 类型处理器
  type-handlers-package: com.lawfirm.common.core.handler
  # 配置文件，避免和Java代码配置冲突
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
    auto-mapping-behavior: partial
    auto-mapping-unknown-column-behavior: none
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    # 避免XML解析错误
    default-enum-type-handler: org.apache.ibatis.type.EnumOrdinalTypeHandler
    # 避免类型冲突
    use-java-type: true
  global-config:
    banner: false
    db-config:
      id-type: auto
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

# 简化安全设置
security:
  user:
    name: ${ADMIN_USERNAME:admin}
    password: ${ADMIN_PASSWORD:${random.uuid}}
    roles: ADMIN

# Redisson配置
redisson:
  enabled: true
  singleServerConfig:
    address: redis://localhost:6379
    password:
    database: 0
    idleConnectionTimeout: 10000
    connectTimeout: 10000
    timeout: 3000
    retryAttempts: 3
    retryInterval: 1500
    subscriptionsPerConnection: 5
    clientName: null
    subscriptionConnectionMinimumIdleSize: 1
    subscriptionConnectionPoolSize: 50
    connectionMinimumIdleSize: 32
    connectionPoolSize: 64
    dnsMonitoringInterval: 5000

# 禁用原始安全配置
auth:
  security:
    enabled: false

# Jasypt加密配置
jasypt:
  encryptor:
    password: your-secret-key
    algorithm: PBEWithMD5AndDES
    provider-name: SunJCE

# 财务模块配置
finance:
  cache:
    enabled: true
    expireTime: 3600
  event:
    async: true
    retryTimes: 3
  business:
    maxPageSize: 100
    exportLimit: 1000

# 配置刷新设置
config:
  refresh:
    enabled: true
    refresh-interval: 60000
    refresh-on-startup: true
    source-type: redis
    source-path: config/

# 统一缓存配置命名规范 (law.firm.* 格式)
law.firm.cache:
  enabled: true
  type: REDIS
  expiration: 30
  refresh-time: 10

# 日志配置 - 统一命名规范
law.firm.log:
  enable-method-log: true
  enable-request-log: true
  enable-async-log: true
  enable-tracing: true
  log-request-params: true
  log-response-body: true
  log-stack-trace: true
  exclude-paths:
    - /swagger-ui/**
    - /v3/api-docs/** 