# 系统升级指南

## 一、升级包制作说明

### 1.1 升级包结构
```
upgrade_package_1.0.1.zip
├── meta.json           # 升级包元信息
├── scripts            # SQL脚本目录
│   ├── upgrade       # 升级脚本
│   └── rollback      # 回滚脚本
└── files             # 更新文件目录
    ├── new          # 新增文件
    ├── update       # 更新文件
    └── delete       # 删除文件列表(delete.txt)
```

### 1.2 meta.json格式
```json
{
    "version": "1.0.1",           // 版本号
    "type": 1,                    // 升级类型(1:整体升级 2:补丁升级)
    "needBackup": true,           // 是否需要备份
    "description": "版本描述",     // 升级说明
    "dependVersion": "1.0.0",     // 依赖版本
    "releaseTime": "2024-01-24"   // 发布时间
}
```

### 1.3 SQL脚本规范
1. 文件命名格式: V{version}__{description}.sql
2. 按序号排序执行
3. 每条SQL语句以分号结尾
4. 支持注释(--或/*)
5. 建议添加回滚脚本

### 1.4 文件更新规范
1. 新增文件: 放在new目录下,保持原目录结构
2. 更新文件: 放在update目录下,保持原目录结构
3. 删除文件: 在delete.txt中列出要删除的文件路径,每行一个

## 二、升级操作说明

### 2.1 升级前准备
1. 检查系统版本是否满足升级条件
2. 确保系统处于稳定状态
3. 建议在使用低峰期进行升级
4. 准备足够的磁盘空间
5. 建议手动备份重要数据

### 2.2 升级步骤
1. 上传升级包
   - 进入系统升级管理页面
   - 选择升级包文件
   - 填写升级说明
   - 点击上传

2. 执行升级
   - 查看升级包详情
   - 确认升级内容
   - 点击执行升级
   - 等待升级完成

3. 验证升级
   - 检查系统版本
   - 验证新功能
   - 检查数据完整性
   - 测试关键功能

### 2.3 升级失败处理
1. 查看错误日志
2. 执行回滚操作
3. 联系技术支持
4. 重新尝试升级

## 三、注意事项

### 3.1 数据安全
1. 重要数据建议手动备份
2. 升级包必须包含回滚脚本
3. 保留足够的回滚时间
4. 定期清理备份文件

### 3.2 升级建议
1. 整体升级建议在系统使用低峰期进行
2. 补丁升级可以根据紧急程度选择时间
3. 升级前检查系统状态和存储空间
4. 升级后及时验证系统功能

### 3.3 常见问题
1. 升级失败如何处理？
   - 查看错误日志定位问题
   - 执行回滚操作
   - 解决问题后重新升级

2. 如何清理备份文件？
   - 定期检查备份目录
   - 删除过期备份文件
   - 保留最近几次的备份

3. 升级过程中断如何处理？
   - 系统会自动回滚
   - 查看日志确认状态
   - 重新执行升级

4. 如何验证升级成功？
   - 检查系统版本号
   - 验证新增功能
   - 测试关键业务
   - 查看升级日志

## 四、升级包示例

### 4.1 整体升级包示例
```plaintext
upgrade_full_1.0.1.zip
├── meta.json
├── scripts
│   ├── upgrade
│   │   ├── V1.0.1__add_new_table.sql
│   │   └── V1.0.1__update_data.sql
│   └── rollback
│       ├── V1.0.1__drop_new_table.sql
│       └── V1.0.1__restore_data.sql
└── files
    ├── new
    │   └── modules
    │       └── new_module
    ├── update
    │   └── modules
    │       └── existing_module
    └── delete
        └── delete.txt
```

### 4.2 补丁升级包示例
```plaintext
upgrade_patch_1.0.1_001.zip
├── meta.json
├── scripts
│   ├── upgrade
│   │   └── V1.0.1_001__fix_bug.sql
│   └── rollback
│       └── V1.0.1_001__restore.sql
└── files
    └── update
        └── modules
            └── bugfix
```

## 五、联系支持

如果在升级过程中遇到问题,请联系技术支持:
- 邮箱: support@xxx.com
- 电话: xxx-xxxxxxxx
- 工作时间: 周一至周五 9:00-18:00 