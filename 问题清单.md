# 律师事务所管理系统 - 问题清单

## 一、安全问题（高优先级）

### 1. 硬编码密码和敏感信息
- [x] `law-firm-api/src/main/resources/application.yml` 中存在明文管理员密码 `admin123`
- [x] `law-firm-api/src/main/resources/application.yml` 中存在MinIO的默认密码 `minioadmin`
- [x] `law-firm-modules/law-firm-knowledge/src/main/resources/application-knowledge.yml` 中存在MinIO的默认密码
- [x] `law-firm-api/src/main/resources/application-docker.yml` 中存在MinIO的默认密码
- [x] `law-firm-api/src/main/resources/application-dev-mysql.yml` 中存在明文密码: `password: Zjy-1314`
- [x] `docker-compose.yml` 中包含硬编码MySQL密码: `SPRING_DATASOURCE_PASSWORD=Zjy-1314`
- [x] 多个模块配置文件中使用通用测试密码如"root"和"password":
  - [x] `law-firm-modules/law-firm-auth/src/main/resources/application.yml`
  - [x] `law-firm-modules/law-firm-contract/src/main/resources/application.yml`
  - [x] `law-firm-modules/law-firm-knowledge/src/main/resources/application-dev.yml`

### 2. 安全配置问题
- [x] API模块启动类中通过`System.setProperty`禁用安全功能:
  ```java
  System.setProperty("security.enable", "false");
  System.setProperty("spring.security.enabled", "false");
  System.setProperty("security.basic.enabled", "false");
  ```
- [ ] 配置文件中包含弱密码: `password: admin123`

### 3. SQL注入风险
- [x] 存在未参数化的SQL拼接，例如：
  ```java
  "SELECT case_id FROM case_team_member WHERE member_id = " + userId)
  ```

## 二、代码质量问题（中优先级）

### 1. 调试代码残留
- [x] 生产代码中包含`System.out.println`调用：
  - `law-firm-modules/law-firm-case/src/main/java/com/lawfirm/cases/config/CaseModuleConfiguration.java`
  - `law-firm-api/src/main/java/com/lawfirm/api/config/NullDdlHandler.java`
  - `law-firm-api/src/main/java/com/lawfirm/api/config/CustomRunnerConfig.java`
- [x] 存在`e.printStackTrace()`调用：
  - `law-firm-api/src/main/java/com/lawfirm/api/LawFirmApiApplication.java`

### 2. 版本管理不一致
- [x] 多个模块直接硬编码依赖版本，违反统一依赖管理原则:
  - `law-firm-modules/law-firm-system/pom.xml`: `<version>3.11.0</version>`, `<version>1.18.30</version>`
  - `law-firm-modules/law-firm-document/pom.xml`: `<version>2.0.3</version>`, `<version>1.14</version>`
  - `law-firm-modules/law-firm-analysis/pom.xml`: `<version>2.3.0</version>`
  - `law-firm-modules/law-firm-archive/pom.xml`: `<version>8.5.7</version>`
  - `law-firm-model/pom.xml`: `<version>3.6.2</version>`

### 3. 硬编码SQL
- [x] 大量使用注解中的硬编码SQL，例如：
  - `law-firm-model/storage-model/src/main/java/com/lawfirm/model/storage/mapper/StorageBucketMapper.java`
  - `law-firm-model/document-model/src/main/java/com/lawfirm/model/document/mapper/DocumentMapper.java`
  - `law-firm-model/personnel-model/src/main/java/com/lawfirm/model/personnel/mapper/*.java`

## 三、架构设计问题（中优先级）

### 1. 循环依赖风险
- [ ] common-security依赖common-web，而common-web包含Spring Security依赖，存在潜在的循环依赖风险

### 2. 配置冗余
- [ ] 多个模块定义几乎相同的缓存配置:
  - `law-firm-modules/law-firm-finance/src/main/java/com/lawfirm/finance/config/CacheConfig.java`
  - `law-firm-modules/law-firm-contract/src/main/java/com/lawfirm/contract/config/CacheConfig.java`
  - `law-firm-modules/law-firm-client/src/main/java/com/lawfirm/client/config/CacheConfig.java`

### 3. 重复的线程池配置
- [ ] 多个模块定义自己的线程池，参数不一致:
  - `law-firm-modules/law-firm-finance/src/main/java/com/lawfirm/finance/config/EventConfig.java`
  - `law-firm-core/core-message/src/main/java/com/lawfirm/core/message/config/MessageConfig.java`
  - `law-firm-core/core-audit/src/main/java/com/lawfirm/core/audit/config/AuditAsyncConfig.java`

### 4. API响应格式不一致
- [ ] 存在多种响应格式，并在API层进行转换:
  - `law-firm-common/common-core/src/main/java/com/lawfirm/common/core/api/CommonResult.java`
  - `law-firm-api/src/main/java/com/lawfirm/api/VbenResult.java`
  - `law-firm-api/src/main/java/com/lawfirm/api/advice/VbenResponseAdvice.java`

## 四、应用配置问题（低优先级）

### 1. 启动配置不规范
- [ ] `LawFirmApiApplication.java`中大量使用`System.setProperty`设置系统属性，不是通过配置文件

### 2. 配置分散
- [ ] 系统配置分散在多个yml文件和Java代码中，缺乏集中管理:
  - application.yml
  - application-dev.yml
  - application-dev-mysql.yml
  - application-prod.yml
  - 以及Java代码中的System.setProperty设置

### 3. 环境配置差异大
- [ ] 不同环境的配置方式差异大，增加了维护难度

## 处理计划

1. 第一阶段：解决安全问题
   - 移除所有硬编码密码
   - 修复安全配置
   - 修复SQL注入风险

2. 第二阶段：改进代码质量
   - 清理调试代码
   - 统一版本管理
   - 规范SQL使用

3. 第三阶段：优化架构设计
   - 修复循环依赖
   - 合并冗余配置
   - 统一线程池管理
   - 统一API响应格式

4. 第四阶段：规范应用配置
   - 优化启动配置
   - 集中管理配置
   - 标准化环境配置差异 